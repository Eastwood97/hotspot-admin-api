<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jsc.hotspot.db.dao.ext.HotNumInfoEXTMapper">
  <resultMap id="BaseResultMap" type="com.jsc.hotspot.db.domain.HotNumInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="imsi" jdbcType="VARCHAR" property="imsi" />
    <result column="imei" jdbcType="VARCHAR" property="imei" />
    <result column="isdn" jdbcType="VARCHAR" property="isdn" />
    <result column="mode" jdbcType="TINYINT" property="mode" />
    <result column="capture_time" jdbcType="TIMESTAMP" property="captureTime" />
    <result column="target_id" jdbcType="BIGINT" property="targetId" />
    <result column="dev_id" jdbcType="BIGINT" property="devId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="attribution" jdbcType="VARCHAR" property="attribution" />
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, imsi, imei, isdn, `mode`, capture_time, target_id, dev_id, create_time, update_time, 
    attribution
  </sql>
  <select id="selectByExample" parameterType="com.jsc.hotspot.db.domain.HotNumInfoExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct">
      distinct
    </if>
    <include refid="Base_Column_List" />
    from hot_num_info
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByExampleSelective" parameterType="map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="example.distinct">
      distinct
    </if>
    <choose>
      <when test="selective != null and selective.length &gt; 0">
        <foreach collection="selective" item="column" separator=",">
          ${column.aliasedEscapedColumnName}
        </foreach>
      </when>
      <otherwise>
        <include refid="Base_Column_List" />
      </otherwise>
    </choose>
    from hot_num_info
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
    <if test="example.orderByClause != null">
      order by ${example.orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from hot_num_info
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectByPrimaryKeySelective" parameterType="map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <choose>
      <when test="selective != null and selective.length &gt; 0">
        <foreach collection="selective" item="column" separator=",">
          ${column.aliasedEscapedColumnName}
        </foreach>
      </when>
      <otherwise>
        <include refid="Base_Column_List" />
      </otherwise>
    </choose>
    from hot_num_info
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from hot_num_info
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <delete id="deleteByExample" parameterType="com.jsc.hotspot.db.domain.HotNumInfoExample">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from hot_num_info
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.jsc.hotspot.db.domain.HotNumInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into hot_num_info (imsi, imei, isdn, 
      `mode`, capture_time, target_id, 
      dev_id, create_time, update_time, 
      attribution)
    values (#{imsi,jdbcType=VARCHAR}, #{imei,jdbcType=VARCHAR}, #{isdn,jdbcType=VARCHAR}, 
      #{mode,jdbcType=TINYINT}, #{captureTime,jdbcType=TIMESTAMP}, #{targetId,jdbcType=BIGINT}, 
      #{devId,jdbcType=BIGINT}, #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{attribution,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.jsc.hotspot.db.domain.HotNumInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into hot_num_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="imsi != null">
        imsi,
      </if>
      <if test="imei != null">
        imei,
      </if>
      <if test="isdn != null">
        isdn,
      </if>
      <if test="mode != null">
        `mode`,
      </if>
      <if test="captureTime != null">
        capture_time,
      </if>
      <if test="targetId != null">
        target_id,
      </if>
      <if test="devId != null">
        dev_id,
      </if>
      <if test="createTime != null">
        create_time,
      </if>
      <if test="updateTime != null">
        update_time,
      </if>
      <if test="attribution != null">
        attribution,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="imsi != null">
        #{imsi,jdbcType=VARCHAR},
      </if>
      <if test="imei != null">
        #{imei,jdbcType=VARCHAR},
      </if>
      <if test="isdn != null">
        #{isdn,jdbcType=VARCHAR},
      </if>
      <if test="mode != null">
        #{mode,jdbcType=TINYINT},
      </if>
      <if test="captureTime != null">
        #{captureTime,jdbcType=TIMESTAMP},
      </if>
      <if test="targetId != null">
        #{targetId,jdbcType=BIGINT},
      </if>
      <if test="devId != null">
        #{devId,jdbcType=BIGINT},
      </if>
      <if test="createTime != null">
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="attribution != null">
        #{attribution,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.jsc.hotspot.db.domain.HotNumInfoExample" resultType="java.lang.Long">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from hot_num_info
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update hot_num_info
    <set>
      <if test="record.id != null">
        id = #{record.id,jdbcType=BIGINT},
      </if>
      <if test="record.imsi != null">
        imsi = #{record.imsi,jdbcType=VARCHAR},
      </if>
      <if test="record.imei != null">
        imei = #{record.imei,jdbcType=VARCHAR},
      </if>
      <if test="record.isdn != null">
        isdn = #{record.isdn,jdbcType=VARCHAR},
      </if>
      <if test="record.mode != null">
        `mode` = #{record.mode,jdbcType=TINYINT},
      </if>
      <if test="record.captureTime != null">
        capture_time = #{record.captureTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.targetId != null">
        target_id = #{record.targetId,jdbcType=BIGINT},
      </if>
      <if test="record.devId != null">
        dev_id = #{record.devId,jdbcType=BIGINT},
      </if>
      <if test="record.createTime != null">
        create_time = #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updateTime != null">
        update_time = #{record.updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.attribution != null">
        attribution = #{record.attribution,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update hot_num_info
    set id = #{record.id,jdbcType=BIGINT},
      imsi = #{record.imsi,jdbcType=VARCHAR},
      imei = #{record.imei,jdbcType=VARCHAR},
      isdn = #{record.isdn,jdbcType=VARCHAR},
      `mode` = #{record.mode,jdbcType=TINYINT},
      capture_time = #{record.captureTime,jdbcType=TIMESTAMP},
      target_id = #{record.targetId,jdbcType=BIGINT},
      dev_id = #{record.devId,jdbcType=BIGINT},
      create_time = #{record.createTime,jdbcType=TIMESTAMP},
      update_time = #{record.updateTime,jdbcType=TIMESTAMP},
      attribution = #{record.attribution,jdbcType=VARCHAR}
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.jsc.hotspot.db.domain.HotNumInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update hot_num_info
    <set>
      <if test="imsi != null">
        imsi = #{imsi,jdbcType=VARCHAR},
      </if>
      <if test="imei != null">
        imei = #{imei,jdbcType=VARCHAR},
      </if>
      <if test="isdn != null">
        isdn = #{isdn,jdbcType=VARCHAR},
      </if>
      <if test="mode != null">
        `mode` = #{mode,jdbcType=TINYINT},
      </if>
      <if test="captureTime != null">
        capture_time = #{captureTime,jdbcType=TIMESTAMP},
      </if>
      <if test="targetId != null">
        target_id = #{targetId,jdbcType=BIGINT},
      </if>
      <if test="devId != null">
        dev_id = #{devId,jdbcType=BIGINT},
      </if>
      <if test="createTime != null">
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null">
        update_time = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="attribution != null">
        attribution = #{attribution,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.jsc.hotspot.db.domain.HotNumInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update hot_num_info
    set imsi = #{imsi,jdbcType=VARCHAR},
      imei = #{imei,jdbcType=VARCHAR},
      isdn = #{isdn,jdbcType=VARCHAR},
      `mode` = #{mode,jdbcType=TINYINT},
      capture_time = #{captureTime,jdbcType=TIMESTAMP},
      target_id = #{targetId,jdbcType=BIGINT},
      dev_id = #{devId,jdbcType=BIGINT},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      attribution = #{attribution,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="selectOneByExample" parameterType="com.jsc.hotspot.db.domain.HotNumInfoExample" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <include refid="Base_Column_List" />
    from hot_num_info
    <if test="_parameter != null">
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null">
      order by ${orderByClause}
    </if>
    limit 1
  </select>
  <select id="selectOneByExampleSelective" parameterType="map" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <choose>
      <when test="selective != null and selective.length &gt; 0">
        <foreach collection="selective" item="column" separator=",">
          ${column.aliasedEscapedColumnName}
        </foreach>
      </when>
      <otherwise>
        <include refid="Base_Column_List" />
      </otherwise>
    </choose>
    from hot_num_info
    <if test="_parameter != null">
      <include refid="Update_By_Example_Where_Clause" />
    </if>
    <if test="example.orderByClause != null">
      order by ${example.orderByClause}
    </if>
    limit 1
  </select>
  <select id="selectDistCount" resultType="java.lang.Long">
    select count(DISTINCT imsi)
    from hot_num_info
  </select>
  <select id="selectCount" resultType="java.util.Map">
    select count(*) AS num,date(capture_time) as capture_time2
    from hot_num_info
    <where>
      capture_time
      BETWEEN #{startTime} AND #{endTime}
    </where>
    GROUP BY capture_time2 order by capture_time2 desc
  </select>

  <select id="selectGuiShuDiList" resultType="java.util.Map">
        select count(*) AS value,attribution AS name
        from hot_num_info
        GROUP BY attribution
    </select>

  <select id="selectTraffic" resultType="java.util.Map">
    SELECT
    imsi_count AS num,DATE( capture_date ) as create_time1
    FROM
    hot_num_day_count
    WHERE
    dev_id = #{devId}
    AND capture_date   BETWEEN #{startTime} AND #{endTime}
    GROUP BY capture_date
  </select>

  <select id="selectGuoBieCount" resultType="java.util.Map">
    SELECT SUM(attribution_num) AS num,attribution FROM hot_num_attr_pre_handle WHERE  dev_id=#{devId}
    and country = "中国" and capture_date
    BETWEEN #{startTime} AND #{endTime}
    GROUP BY attribution ORDER BY num DESC LIMIT 10
  </select>

  <select id="selectGuojiCount" resultType="java.util.Map">
    SELECT "国内" AS country,SUM(attribution_num) AS num
    FROM hot_num_attr_pre_handle where dev_id=#{devId}
    and country = "中国"
    and capture_date
    BETWEEN #{startTime} AND #{endTime}
  </select>

  <!--国内国外查询-->
  <select id="selectGuojiCounts" resultType="java.util.Map">
    SELECT "国外" AS country,SUM(attribution_num) AS num
    FROM hot_num_attr_pre_handle
    where dev_id=#{devId}
    and country != "中国"
    and capture_date
    BETWEEN #{startTime} AND #{endTime}
  </select>

  <select id="selectMyGeGuoCount" resultType="java.util.Map">
    SELECT SUM(attribution_num) AS num,"中国" AS country FROM
    hot_num_attr_pre_handle
    where dev_id=#{devId}
    and country = "中国"
    and capture_date
    BETWEEN #{startTime} AND #{endTime}
  </select>

  <select id="selectGuoWaiGeGuoCount" resultType="java.util.Map">
    SELECT SUM(attribution_num) AS num,attribution as country FROM
    hot_num_attr_pre_handle
    where dev_id=#{devId}
    and country != "中国"
    and capture_date
    BETWEEN #{startTime} AND #{endTime}
    GROUP BY attribution  ORDER BY num DESC LIMIT 9
  </select>
  <select id="selectbansuiLists" resultType="java.util.Map">
    SELECT a.id, a.dev_id,a.imsi, a.imei, a.attribution, a.create_time FROM hot_num_info a
    JOIN (
    SELECT
    <include refid="Base_Column_List"/>
    FROM hot_num_info WHERE id=#{id} and dev_id=#{devId}
    )b ON a.create_time BETWEEN DATE_SUB(b.create_time,INTERVAL #{createTime} SECOND)
    AND DATE_ADD(b.create_time,INTERVAL #{createTime} SECOND) AND b.id !=a.id and b.dev_id=a.dev_id
  </select>
  <select id="selectHotNumInfoList"  resultType="java.util.Map">
    select
    h.id, h.imsi,h.imei,h.isdn,h.mode,h.capture_time as captureTime,h.target_id as targetId,h.dev_id as devId,h.create_time,h.update_time,h.attribution
    from hot_num_info h inner join (
    select id from hot_num_info
    <where>
      <if test="dev_id !=null and dev_id !=''">
        and dev_id=#{dev_id}
      </if>
      <if test="imsi !=null and imsi !=''">
        and imsi=#{imsi}
      </if>
      <if test="imei !=null and imei !=''">
        and imei=#{imei}
      </if>
      <if test="isdn !=null and isdn !=''">
        and isdn=#{isdn}
      </if>
      <if test="capture_time !=null">
        and capture_time between #{startTime} and #{endTime}
      </if>
    </where>
    order by id desc limit #{page},#{rows}
    )t
    on h.id=t.id
  </select>
  <select id="countDistinctByIMSI">
    SELECT count(distinct imsi) from hot_num_info
  </select>
<!--  <select id="selectNumInfoByDay" resultType="java.util.Map">-->
<!--    SELECT date(capture_time) t,count(distinct imsi)-->
<!--        from hot_num_info-->
<!--        WHERE capture_time between (#{capture_time} - 15) and #{capture_time}-->
<!--        group BY t-->
<!--  </select>-->
<!--  <select id="selectNumInfoByMonth" resultType="java.util.Map">-->
<!--    SELECT month(capture_time) t,count(distinct imsi)-->
<!--        from hot_num_info-->
<!--        WHERE capture_time between (#{capture_time} - 30) and #{capture_time}-->
<!--        group BY t-->
<!--  </select>-->
</mapper>
